<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒêƒÉng k√Ω t√†i kho·∫£n</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f7ff;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .register-card {
      background:#fff;
      width:100%;
      max-width:480px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(59,130,246,0.1);
      overflow:hidden;
    }
    .header {
      background:#3b82f6;
      padding:28px 24px;
      text-align:center;
      color:#fff;
    }
    .header h1 {
      font-size:24px;
      font-weight:600;
      margin-bottom:4px;
    }
    .header p {
      font-size:14px;
      opacity:0.95;
    }
    .form-container {
      padding:28px 24px;
    }
    .form-group {
      margin-bottom:16px;
    }
    .form-group label {
      display:block;
      font-size:14px;
      font-weight:500;
      color:#374151;
      margin-bottom:6px;
    }
    .form-group label .required {
      color:#ef4444;
    }
    .input-wrapper input {
      width:100%;
      padding:11px 14px;
      font-size:15px;
      border:1px solid #d1d5db;
      border-radius:6px;
      transition: border-color 0.2s;
    }
    .input-wrapper input:focus {
      outline:none;
      border-color:#3b82f6;
    }
    .form-row {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .btn-submit {
      width:100%;
      padding:12px;
      font-size:15px;
      font-weight:600;
      color:#fff;
      background:#3b82f6;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin-top:8px;
    }
    .btn-submit:hover:not(:disabled) {
      background:#2563eb;
    }
    .btn-submit:disabled {
      opacity:0.6;
      cursor:not-allowed;
    }
    .links {
      text-align:center;
      margin-top:16px;
      font-size:13px;
      color:#6b7280;
    }
    .links a {
      color:#3b82f6;
      text-decoration:none;
      font-weight:500;
    }
    .links a:hover {
      text-decoration:underline;
    }
    .alert {
      padding:10px 12px;
      border-radius:6px;
      margin-bottom:14px;
      font-size:14px;
    }
    .alert.error {
      background:#fee;
      color:#b91c1c;
      border:1px solid #fecaca;
    }
    .alert.success {
      background:#f0fdf4;
      color:#166534;
      border:1px solid #bbf7d0;
    }
    .password-hint {
      font-size:12px;
      color:#6b7280;
      margin-top:4px;
    }
  </style>
</head>
<body>
  <div class="register-card">
    <div class="header">
      <h1>üçΩÔ∏è ƒêƒÉng k√Ω t√†i kho·∫£n</h1>
      <p>T·∫°o t√†i kho·∫£n m·ªõi ƒë·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª•</p>
    </div>

    <div class="form-container">
      <div id="alertBox"></div>

      <form id="registerForm">
        <div class="form-group">
          <label>Email <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="email" name="email" id="email" required autocomplete="email" placeholder="example@gmail.com">
          </div>
        </div>

        <div class="form-group">
          <label>M·∫≠t kh·∫©u <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="password" name="password" id="password" required autocomplete="new-password" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
          </div>
          <div class="password-hint">M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±</div>
        </div>

        <div class="form-group">
          <label>X√°c nh·∫≠n m·∫≠t kh·∫©u <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="password" name="confirmPassword" id="confirmPassword" required autocomplete="new-password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
          </div>
        </div>

        <div class="form-group">
          <label>H·ªç v√† t√™n <span class="required">*</span></label>
          <div class="input-wrapper">
            <input type="text" name="name" id="name" required autocomplete="name" placeholder="Nguy·ªÖn VƒÉn A">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span></label>
            <div class="input-wrapper">
              <input type="tel" name="phone" id="phone" required autocomplete="tel" placeholder="0912345678">
            </div>
          </div>

          <div class="form-group">
            <label>CCCD/CMND <span class="required">*</span></label>
            <div class="input-wrapper">
              <input type="text" name="identityCard" id="identityCard" required placeholder="001234567890">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>ƒê·ªãa ch·ªâ</label>
          <div class="input-wrapper">
            <input type="text" name="address" id="address" autocomplete="street-address" placeholder="123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ">
          </div>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn">ƒêƒÉng k√Ω</button>
      </form>

      <div class="links">
        ƒê√£ c√≥ t√†i kho·∫£n? <a href="/login">ƒêƒÉng nh·∫≠p ngay</a>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('registerForm');
    const submitBtn = document.getElementById('submitBtn');
    const alertBox = document.getElementById('alertBox');

    function showAlert(message, type) {
      alertBox.innerHTML = `<div class="alert ${type}">${message}</div>`;
      setTimeout(() => { alertBox.innerHTML = ''; }, 5000);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const identityCard = document.getElementById('identityCard').value.trim();
      const address = document.getElementById('address').value.trim();

      // Validation
      if (!email || !password || !confirmPassword || !name || !phone || !identityCard) {
        showAlert('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc!', 'error');
        return;
      }

      if (password.length < 6) {
        showAlert('‚ùå M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!', 'error');
        return;
      }

      if (password !== confirmPassword) {
        showAlert('‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!', 'error');
        return;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showAlert('‚ùå Email kh√¥ng h·ª£p l·ªá!', 'error');
        return;
      }

      // Phone validation (10-11 digits)
      const phoneRegex = /^[0-9]{10,11}$/;
      if (!phoneRegex.test(phone)) {
        showAlert('‚ùå S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (10-11 s·ªë)!', 'error');
        return;
      }

      // Identity card validation (9 or 12 digits)
      const idRegex = /^[0-9]{9}$|^[0-9]{12}$/;
      if (!idRegex.test(identityCard)) {
        showAlert('‚ùå CCCD/CMND kh√¥ng h·ª£p l·ªá (9 ho·∫∑c 12 s·ªë)!', 'error');
        return;
      }

      // Submit
      submitBtn.disabled = true;
      submitBtn.textContent = 'ƒêang x·ª≠ l√Ω...';

      // Generate UserCode from email
      const userCode = 'USER' + Date.now().toString().slice(-8);

      try {
        const response = await fetch('/api/account/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            UserCode: userCode,
            UserEmail: email,
            UserPhone: phone,
            UserPassword: password,
            Name: name,
            IdentityCard: identityCard,
            UserAddress: address || ''
          })
        });

        const data = await response.json();

        if (response.ok) {
          showAlert('‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang chuy·ªÉn ƒë·∫øn trang ƒëƒÉng nh·∫≠p...', 'success');
          setTimeout(() => {
            window.location.href = '/login';
          }, 1500);
        } else {
          showAlert(`‚ùå ${data.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i!'}`, 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'ƒêƒÉng k√Ω';
        }
      } catch (error) {
        console.error('Register error:', error);
        showAlert('‚ùå L·ªói k·∫øt n·ªëi! Vui l√≤ng th·ª≠ l·∫°i sau.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'ƒêƒÉng k√Ω';
      }
    });
  </script>
</body>
</html>
