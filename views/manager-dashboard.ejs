<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manager Dashboard</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f7ff;
      min-height:100vh;
    }
    .navbar {
      background:#3b82f6;
      color:#fff;
      padding:16px 24px;
      box-shadow:0 2px 8px rgba(59,130,246,0.2);
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:sticky;
      top:0;
      z-index:100;
    }
    .navbar h1 {
      font-size:22px;
      font-weight:600;
    }
    .navbar .user-info {
      display:flex;
      align-items:center;
      gap:16px;
      font-size:14px;
    }
    .navbar .user-info span {
      padding:8px 16px;
      background:rgba(255,255,255,0.15);
      border-radius:6px;
    }
    .navbar .user-info a.user-link {
      padding:8px 16px;
      background:rgba(255,255,255,0.15);
      border-radius:6px;
      color:#fff;
      text-decoration:none;
      cursor:pointer;
      transition: background 0.3s;
    }
    .navbar .user-info a.user-link:hover {
      background:rgba(255,255,255,0.25);
    }
    .navbar button {
      padding:8px 16px;
      background:#fff;
      color:#3b82f6;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .navbar button:hover {
      background:#f0f7ff;
    }
    .container {
      max-width:1400px;
      margin:0 auto;
      padding:24px 20px;
    }
    .stats-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
      gap:20px;
      margin-bottom:32px;
    }
    .stat-card {
      background:#fff;
      padding:24px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(59,130,246,0.1);
    }
    .stat-card h3 {
      font-size:14px;
      color:#6b7280;
      margin-bottom:12px;
      font-weight:500;
    }
    .stat-card .value {
      font-size:32px;
      font-weight:700;
      color:#3b82f6;
      margin-bottom:8px;
    }
    .stat-card .label {
      font-size:13px;
      color:#9ca3af;
    }
    .section-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }
    .section-header h2 {
      font-size:20px;
      color:#1f2937;
      font-weight:600;
    }
    .btn-primary {
      padding:10px 20px;
      background:#3b82f6;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .btn-primary:hover {
      background:#2563eb;
    }
    .filter-bar {
      background:#fff;
      padding:16px 20px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(59,130,246,0.1);
      margin-bottom:20px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .filter-bar input, .filter-bar select {
      padding:10px 14px;
      border:1px solid #d1d5db;
      border-radius:6px;
      font-size:14px;
      min-width:180px;
    }
    .filter-bar input:focus, .filter-bar select:focus {
      outline:none;
      border-color:#3b82f6;
    }
    .filter-bar button {
      padding:10px 20px;
      background:#3b82f6;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .filter-bar button:hover {
      background:#2563eb;
    }
    .filter-bar .btn-reset {
      background:#6b7280;
    }
    .filter-bar .btn-reset:hover {
      background:#4b5563;
    }
    .table-container {
      background:#fff;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(59,130,246,0.1);
      overflow:hidden;
    }
    table {
      width:100%;
      border-collapse:collapse;
    }
    thead {
      background:#f9fafb;
      border-bottom:2px solid #e5e7eb;
    }
    thead th {
      padding:14px 16px;
      text-align:left;
      font-size:13px;
      font-weight:600;
      color:#374151;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    tbody tr {
      border-bottom:1px solid #f3f4f6;
    }
    tbody tr:hover {
      background:#f9fafb;
    }
    tbody td {
      padding:14px 16px;
      font-size:14px;
      color:#1f2937;
    }
    .dish-image-small {
      width:50px;
      height:50px;
      object-fit:cover;
      border-radius:6px;
      background:#e5e7eb;
    }
    .badge {
      display:inline-block;
      padding:4px 10px;
      border-radius:4px;
      font-size:12px;
      font-weight:600;
    }
    .badge-available { background:#d1fae5; color:#065f46; }
    .badge-unavailable { background:#fee2e2; color:#991b1b; }
    .badge-sufficient { background:#dbeafe; color:#1e40af; }
    .badge-insufficient { background:#fef3c7; color:#92400e; }
    .actions {
      display:flex;
      gap:8px;
    }
    .btn-action {
      padding:6px 12px;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-size:12px;
      font-weight:600;
    }
    .btn-edit {
      background:#dbeafe;
      color:#1e40af;
    }
    .btn-edit:hover {
      background:#bfdbfe;
    }
    .btn-delete {
      background:#fee2e2;
      color:#991b1b;
    }
    .btn-delete:hover {
      background:#fecaca;
    }
    .modal {
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      z-index:1000;
      align-items:center;
      justify-content:center;
    }
    .modal.active {
      display:flex;
    }
    .modal-content {
      background:#fff;
      border-radius:12px;
      width:90%;
      max-width:600px;
      max-height:90vh;
      overflow-y:auto;
    }
    .modal-header {
      padding:20px 24px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .modal-header h3 {
      font-size:18px;
      font-weight:600;
      color:#1f2937;
    }
    .btn-close {
      background:transparent;
      border:none;
      font-size:24px;
      color:#6b7280;
      cursor:pointer;
      padding:0;
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:4px;
    }
    .btn-close:hover {
      background:#f3f4f6;
    }
    .modal-body {
      padding:24px;
    }
    .form-group {
      margin-bottom:18px;
    }
    .form-group label {
      display:block;
      font-size:14px;
      font-weight:500;
      color:#374151;
      margin-bottom:6px;
    }
    .form-group label .required {
      color:#ef4444;
    }
    .form-group input, .form-group select, .form-group textarea {
      width:100%;
      padding:11px 14px;
      font-size:14px;
      border:1px solid #d1d5db;
      border-radius:6px;
      font-family:inherit;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline:none;
      border-color:#3b82f6;
    }
    .form-group textarea {
      resize:vertical;
      min-height:80px;
    }
    .form-row {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
    }
    .modal-footer {
      padding:16px 24px;
      border-top:1px solid #e5e7eb;
      display:flex;
      justify-content:flex-end;
      gap:12px;
    }
    .btn-secondary {
      padding:10px 20px;
      background:#f3f4f6;
      color:#374151;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .btn-secondary:hover {
      background:#e5e7eb;
    }
    .alert {
      padding:12px 16px;
      border-radius:6px;
      margin-bottom:20px;
      font-size:14px;
    }
    .alert.error {
      background:#fee;
      color:#b91c1c;
      border:1px solid #fecaca;
    }
    .alert.success {
      background:#f0fdf4;
      color:#166534;
      border:1px solid #bbf7d0;
    }
    .loading {
      text-align:center;
      padding:40px;
      font-size:16px;
      color:#6b7280;
    }
    .empty-state {
      text-align:center;
      padding:60px 20px;
    }
    .empty-state h3 {
      font-size:18px;
      color:#6b7280;
      margin-bottom:8px;
    }
    .empty-state p {
      color:#9ca3af;
      font-size:14px;
    }
    .pagination {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:12px;
      margin-top:24px;
      padding:20px;
    }
    .pagination button {
      padding:10px 16px;
      background:#fff;
      color:#3b82f6;
      border:1px solid #bfdbfe;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .pagination button:hover:not(:disabled) {
      background:#eff6ff;
    }
    .pagination button:disabled {
      opacity:0.5;
      cursor:not-allowed;
    }
    .pagination span {
      color:#6b7280;
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>üë®‚Äçüíº Manager Dashboard</h1>
    <div class="user-info">
      <a href="/profile" class="user-link" id="userName">üë§ ƒêang t·∫£i...</a>
      <button onclick="window.location.href='/coupon'">üéüÔ∏è Qu·∫£n l√Ω Coupon</button>
      <button onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>
  </div>

  <div class="container">
    <div id="alertBox"></div>

    <!-- Statistics -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>T·ªïng s·ªë m√≥n ƒÉn</h3>
        <div class="value" id="totalDishes">0</div>
        <div class="label">M√≥n ƒÉn trong h·ªá th·ªëng</div>
      </div>
      <div class="stat-card">
        <h3>M√≥n ƒëang c√≥ s·∫µn</h3>
        <div class="value" id="availableDishes">0</div>
        <div class="label">C√≥ th·ªÉ ƒë·∫∑t m√≥n</div>
      </div>
      <div class="stat-card">
        <h3>M√≥n h·∫øt</h3>
        <div class="value" id="unavailableDishes">0</div>
        <div class="label">T·∫°m th·ªùi h·∫øt</div>
      </div>
      <div class="stat-card">
        <h3>Thi·∫øu nguy√™n li·ªáu</h3>
        <div class="value" id="insufficientDishes">0</div>
        <div class="label">C·∫ßn b·ªï sung</div>
      </div>
    </div>

    <!-- Dishes Management -->
    <div class="section-header">
      <h2>Qu·∫£n l√Ω m√≥n ƒÉn</h2>
      <button class="btn-primary" onclick="openAddModal()">+ Th√™m m√≥n m·ªõi</button>
    </div>

    <div class="filter-bar">
      <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm m√≥n ƒÉn...">
      <select id="typeFilter">
        <option value="">T·∫•t c·∫£ lo·∫°i</option>
        <option value="Food">ƒê·ªì ƒÉn</option>
        <option value="Drink">ƒê·ªì u·ªëng</option>
      </select>
      <select id="statusFilter">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="Available">C√≥ s·∫µn</option>
        <option value="Unavailable">Kh√¥ng c√≥ s·∫µn</option>
      </select>
      <button onclick="applyFilters()">L·ªçc</button>
      <button class="btn-reset" onclick="resetFilters()">ƒê·∫∑t l·∫°i</button>
    </div>

    <div class="table-container">
      <div id="dishesTable">
        <div class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
      </div>
    </div>

    <div id="paginationContainer"></div>
  </div>

  <!-- Add/Edit Modal -->
  <div id="dishModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Th√™m m√≥n m·ªõi</h3>
        <button class="btn-close" onclick="closeModal()">&times;</button>
      </div>
      <form id="dishForm">
        <div class="modal-body">
          <div class="form-group">
            <label>T√™n m√≥n <span class="required">*</span></label>
            <input type="text" id="dishName" required placeholder="VD: Ph·ªü b√≤">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Lo·∫°i m√≥n <span class="required">*</span></label>
              <select id="dishType" required>
                <option value="">Ch·ªçn lo·∫°i m√≥n</option>
                <option value="Food">ƒê·ªì ƒÉn</option>
                <option value="Drink">ƒê·ªì u·ªëng</option>
              </select>
            </div>

            <div class="form-group">
              <label>Gi√° (VNƒê) <span class="required">*</span></label>
              <input type="number" id="dishPrice" required min="0" placeholder="50000">
            </div>
          </div>

          <div class="form-group">
            <label>M√¥ t·∫£</label>
            <textarea id="dishDescription" placeholder="M√¥ t·∫£ m√≥n ƒÉn..."></textarea>
          </div>

          <div class="form-group">
            <label>H√¨nh ·∫£nh (URL)</label>
            <input type="text" id="dishImage" placeholder="https://example.com/image.jpg">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Tr·∫°ng th√°i m√≥n <span class="required">*</span></label>
              <select id="dishStatus" required>
                <option value="Available">C√≥ s·∫µn</option>
                <option value="Unavailable">Kh√¥ng c√≥ s·∫µn</option>
              </select>
            </div>

            <div class="form-group">
              <label>Tr·∫°ng th√°i nguy√™n li·ªáu <span class="required">*</span></label>
              <select id="ingredientStatus" required>
                <option value="Sufficient">ƒê·ªß nguy√™n li·ªáu</option>
                <option value="Insufficient">Thi·∫øu nguy√™n li·ªáu</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeModal()">H·ªßy</button>
          <button type="submit" class="btn-primary" id="submitBtn">L∆∞u</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let totalPages = 1;
    let currentFilters = {};
    let editingDishId = null;

    // Load user info
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    if (user.Name) {
      document.getElementById('userName').textContent = user.Name;
    }

    // Check authentication and role
    const token = localStorage.getItem('token');
    if (!token || user.UserRole !== 'Manager') {
      alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y!');
      window.location.href = '/login';
    }

    // Logout
    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = '/login';
    }

    // Show alert
    function showAlert(message, type) {
      const alertBox = document.getElementById('alertBox');
      alertBox.innerHTML = `<div class="alert ${type}">${message}</div>`;
      setTimeout(() => { alertBox.innerHTML = ''; }, 3000);
    }

    // Format price
    function formatPrice(price) {
      return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
    }

    // Load statistics
    async function loadStatistics() {
      try {
        console.log('[Stats] Loading statistics...');
        const response = await fetch('/api/menu?limit=100', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        console.log('[Stats] Response status:', response.status);
        
        if (response.ok) {
          const data = await response.json();
          console.log('[Stats] Data received:', data);
          const dishes = data.data || [];
          
          console.log('[Stats] Total dishes:', dishes.length);
          document.getElementById('totalDishes').textContent = dishes.length;
          document.getElementById('availableDishes').textContent = dishes.filter(d => d.DishStatus === 'Available').length;
          document.getElementById('unavailableDishes').textContent = dishes.filter(d => d.DishStatus === 'Unavailable').length;
          document.getElementById('insufficientDishes').textContent = dishes.filter(d => d.IngredientStatus === 'Insufficient').length;
        } else {
          console.error('[Stats] Failed to load:', response.statusText);
        }
      } catch (error) {
        console.error('[Stats] Load statistics error:', error);
      }
    }

    // Load dishes
    async function loadDishes(page = 1) {
      try {
        const params = new URLSearchParams({
          page,
          limit: 10,
          ...currentFilters
        });

        const response = await fetch(`/api/menu?${params}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!response.ok) throw new Error('Failed to load dishes');

        const data = await response.json();
        displayDishes(data.data);
        displayPagination(data.pagination);
      } catch (error) {
        console.error('Load dishes error:', error);
        document.getElementById('dishesTable').innerHTML = `
          <div class="empty-state">
            <h3>‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch m√≥n ƒÉn</h3>
            <p>Vui l√≤ng th·ª≠ l·∫°i sau</p>
          </div>
        `;
      }
    }

    // Display dishes
    function displayDishes(dishes) {
      const container = document.getElementById('dishesTable');

      if (!dishes || dishes.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>üçΩÔ∏è Kh√¥ng t√¨m th·∫•y m√≥n ƒÉn n√†o</h3>
            <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th√™m m√≥n m·ªõi</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>H√¨nh ·∫£nh</th>
              <th>T√™n m√≥n</th>
              <th>Lo·∫°i</th>
              <th>Gi√°</th>
              <th>Tr·∫°ng th√°i m√≥n</th>
              <th>Nguy√™n li·ªáu</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            ${dishes.map(dish => `
              <tr>
                <td>
                  <img src="${dish.DishImage || '/images/default-dish.jpg'}" 
                       alt="${dish.DishName}" 
                       class="dish-image-small" 
                       onerror="this.src='/images/default-dish.jpg'">
                </td>
                <td><strong>${dish.DishName}</strong></td>
                <td>${dish.DishType}</td>
                <td>${formatPrice(dish.DishPrice)}</td>
                <td>
                  <span class="badge ${dish.DishStatus === 'Available' ? 'badge-available' : 'badge-unavailable'}">
                    ${dish.DishStatus === 'Available' ? '‚úì C√≥ s·∫µn' : '‚úó H·∫øt'}
                  </span>
                </td>
                <td>
                  <span class="badge ${dish.IngredientStatus === 'Sufficient' ? 'badge-sufficient' : 'badge-insufficient'}">
                    ${dish.IngredientStatus === 'Sufficient' ? '‚úì ƒê·ªß' : '‚ö† Thi·∫øu'}
                  </span>
                </td>
                <td>
                  <div class="actions">
                    <button class="btn-action btn-edit" onclick="openEditModal('${dish._id}')">‚úèÔ∏è S·ª≠a</button>
                    <button class="btn-action btn-delete" onclick="deleteDish('${dish._id}', '${dish.DishName}')">üóëÔ∏è X√≥a</button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    // Display pagination
    function displayPagination(pagination) {
      currentPage = pagination.currentPage;
      totalPages = pagination.totalPages;

      const container = document.getElementById('paginationContainer');
      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }

      container.innerHTML = `
        <div class="pagination">
          <button onclick="loadDishes(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
            ‚Üê Tr∆∞·ªõc
          </button>
          <span>Trang ${currentPage} / ${totalPages}</span>
          <button onclick="loadDishes(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
            Sau ‚Üí
          </button>
        </div>
      `;
    }

    // Apply filters
    function applyFilters() {
      currentFilters = {};
      
      const search = document.getElementById('searchInput').value.trim();
      const type = document.getElementById('typeFilter').value;
      const status = document.getElementById('statusFilter').value;

      if (search) currentFilters.search = search;
      if (type) currentFilters.type = type;
      if (status) currentFilters.status = status;

      loadDishes(1);
    }

    // Reset filters
    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('typeFilter').value = '';
      document.getElementById('statusFilter').value = '';
      currentFilters = {};
      loadDishes(1);
    }

    // Open add modal
    function openAddModal() {
      editingDishId = null;
      document.getElementById('modalTitle').textContent = 'Th√™m m√≥n m·ªõi';
      document.getElementById('dishForm').reset();
      document.getElementById('dishModal').classList.add('active');
    }

    // Open edit modal
    async function openEditModal(dishId) {
      try {
        editingDishId = dishId;
        document.getElementById('modalTitle').textContent = 'Ch·ªânh s·ª≠a m√≥n ƒÉn';

        const response = await fetch(`/api/manager/dishes/${dishId}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!response.ok) throw new Error('Failed to load dish');

        const data = await response.json();
        const dish = data.data;

        document.getElementById('dishName').value = dish.DishName;
        document.getElementById('dishType').value = dish.DishType;
        document.getElementById('dishPrice').value = dish.DishPrice;
        document.getElementById('dishDescription').value = dish.DishDescription || '';
        document.getElementById('dishImage').value = dish.DishImage || '';
        document.getElementById('dishStatus').value = dish.DishStatus;
        document.getElementById('ingredientStatus').value = dish.IngredientStatus;

        document.getElementById('dishModal').classList.add('active');
      } catch (error) {
        console.error('Load dish error:', error);
        showAlert('‚ùå Kh√¥ng th·ªÉ t·∫£i th√¥ng tin m√≥n ƒÉn!', 'error');
      }
    }

    // Close modal
    function closeModal() {
      document.getElementById('dishModal').classList.remove('active');
      editingDishId = null;
    }

    // Submit form
    document.getElementById('dishForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'ƒêang x·ª≠ l√Ω...';

      const dishData = {
        DishName: document.getElementById('dishName').value.trim(),
        DishType: document.getElementById('dishType').value,
        DishPrice: parseFloat(document.getElementById('dishPrice').value),
        DishDescription: document.getElementById('dishDescription').value.trim(),
        DishImage: document.getElementById('dishImage').value.trim(),
        DishStatus: document.getElementById('dishStatus').value,
        IngredientStatus: document.getElementById('ingredientStatus').value
      };

      try {
        const url = editingDishId 
          ? `/api/manager/dishes/${editingDishId}` 
          : '/api/manager/dishes';
        const method = editingDishId ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dishData)
        });

        const data = await response.json();

        if (response.ok) {
          showAlert(`‚úÖ ${editingDishId ? 'C·∫≠p nh·∫≠t' : 'Th√™m'} m√≥n ƒÉn th√†nh c√¥ng!`, 'success');
          closeModal();
          loadDishes(currentPage);
          loadStatistics();
        } else {
          showAlert(`‚ùå ${data.message}`, 'error');
        }
      } catch (error) {
        console.error('Submit error:', error);
        showAlert('‚ùå L·ªói k·∫øt n·ªëi! Vui l√≤ng th·ª≠ l·∫°i sau.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'L∆∞u';
      }
    });

    // Delete dish
    async function deleteDish(dishId, dishName) {
      if (!confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√≥n "${dishName}"?`)) {
        return;
      }

      try {
        const response = await fetch(`/api/manager/dishes/${dishId}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });

        const data = await response.json();

        if (response.ok) {
          showAlert('‚úÖ X√≥a m√≥n ƒÉn th√†nh c√¥ng!', 'success');
          loadDishes(currentPage);
          loadStatistics();
        } else {
          showAlert(`‚ùå ${data.message}`, 'error');
        }
      } catch (error) {
        console.error('Delete error:', error);
        showAlert('‚ùå L·ªói k·∫øt n·ªëi! Vui l√≤ng th·ª≠ l·∫°i sau.', 'error');
      }
    }

    // Enter key to search
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') applyFilters();
    });

    // Initialize
    (async function init() {
      await loadStatistics();
      await loadDishes(1);
    })();
  </script>
</body>
</html>
